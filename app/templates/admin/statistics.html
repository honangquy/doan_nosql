{% extends 'admin/layout.html' %}

{% block title %}Thống Kê Hệ Thống - Admin Panel{% endblock %}

{% block page_title %}Thống Kê Tổng Hợp{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
<li class="breadcrumb-item active">Thống Kê</li>
{% endblock %}

{% block content %}
<!-- Overview Stats -->
<div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="stats-card modern-card">
            <div class="stats-icon bg-primary-gradient">
                <i class="bi bi-people-fill"></i>
            </div>
            <div class="stats-content">
                <h3 class="stats-number">{{ stats.total_customers }}</h3>
                <p class="stats-label">Tổng Khách Hàng</p>
                <div class="stats-change positive">
                    <i class="bi bi-arrow-up"></i>
                    <span>+12%</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="stats-card modern-card">
            <div class="stats-icon bg-success-gradient">
                <i class="bi bi-bus-front-fill"></i>
            </div>
            <div class="stats-content">
                <h3 class="stats-number">{{ stats.total_vehicles }}</h3>
                <p class="stats-label">Tổng Xe Khách</p>
                <div class="stats-change positive">
                    <i class="bi bi-arrow-up"></i>
                    <span>+3</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="stats-card modern-card">
            <div class="stats-icon bg-warning-gradient">
                <i class="bi bi-signpost-2-fill"></i>
            </div>
            <div class="stats-content">
                <h3 class="stats-number">{{ stats.total_routes }}</h3>
                <p class="stats-label">Tuyến Đường</p>
                <div class="stats-change positive">
                    <i class="bi bi-arrow-up"></i>
                    <span>+2</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="stats-card modern-card">
            <div class="stats-icon bg-info-gradient">
                <i class="bi bi-ticket-detailed-fill"></i>
            </div>
            <div class="stats-content">
                <h3 class="stats-number">{{ stats.total_tickets }}</h3>
                <p class="stats-label">Vé Đã Bán</p>
                <div class="stats-change positive">
                    <i class="bi bi-arrow-up"></i>
                    <span>+25</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart Section -->
<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="chart-card modern-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Biểu Đồ Doanh Thu</h5>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Xuất PDF</a></li>
                        <li><a class="dropdown-item" href="#">Xuất Excel</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <canvas id="revenueChart" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="chart-card modern-card">
            <div class="card-header">
                <h5 class="card-title mb-0">Phân Bố Xe Khách</h5>
            </div>
            <div class="card-body">
                <canvas id="vehicleChart" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Data Tables -->
<div class="row g-4">
    <div class="col-lg-6">
        <div class="modern-card">
            <div class="card-header">
                <h5 class="card-title mb-0">Thống Kê Cơ Bản</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Loại</th>
                                <th>Số Lượng</th>
                                <th>Tỷ Lệ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Tuyến Đường</td>
                                <td>{{ stats.total_routes }}</td>
                                <td>
                                    <div class="progress" style="height: 6px;">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 75%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Xe Khách</td>
                                <td>{{ stats.total_vehicles }}</td>
                                <td>
                                    <div class="progress" style="height: 6px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 60%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Khách Hàng</td>
                                <td>{{ stats.total_customers }}</td>
                                <td>
                                    <div class="progress" style="height: 6px;">
                                        <div class="progress-bar bg-info" role="progressbar" style="width: 90%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Vé Đã Bán</td>
                                <td>{{ stats.total_tickets }}</td>
                                <td>
                                    <div class="progress" style="height: 6px;">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 85%"></div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="modern-card">
            <div class="card-header">
                <h5 class="card-title mb-0">Hoạt Động Gần Đây</h5>
            </div>
            <div class="card-body">
                <div class="activity-feed">
                    <div class="activity-item">
                        <div class="activity-icon bg-success">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div class="activity-content">
                            <h6 class="mb-1">Chuyến xe mới được tạo</h6>
                            <p class="mb-0 text-muted">Tuyến TP.HCM - Đà Lạt</p>
                            <small class="text-muted">2 giờ trước</small>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon bg-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <div class="activity-content">
                            <h6 class="mb-1">Xe cần bảo trì</h6>
                            <p class="mb-0 text-muted">Xe biển số: 51B-12345</p>
                            <small class="text-muted">4 giờ trước</small>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon bg-info">
                            <i class="bi bi-person-plus"></i>
                        </div>
                        <div class="activity-content">
                            <h6 class="mb-1">Khách hàng mới</h6>
                            <p class="mb-0 text-muted">Nguyễn Văn A đăng ký</p>
                            <small class="text-muted">6 giờ trước</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Revenue Chart
const revenueCtx = document.getElementById('revenueChart').getContext('2d');
new Chart(revenueCtx, {
    type: 'line',
    data: {
        labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
        datasets: [{
            label: 'Doanh thu (VND)',
            data: [12000000, 19000000, 15000000, 25000000, 22000000, 30000000, 28000000, 32000000, 35000000, 40000000, 38000000, 45000000],
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return new Intl.NumberFormat('vi-VN').format(value) + ' VND';
                    }
                }
            }
        }
    }
});

// Vehicle Distribution Chart
const vehicleCtx = document.getElementById('vehicleChart').getContext('2d');
new Chart(vehicleCtx, {
    type: 'doughnut',
    data: {
        labels: ['Limousine', 'Giường nằm', 'Ghế ngồi', 'VIP'],
        datasets: [{
            data: [30, 45, 25, 15],
            backgroundColor: [
                '#FF6384',
                '#36A2EB', 
                '#FFCE56',
                '#4BC0C0'
            ]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
</script>

<!-- Custom CSS for Statistics -->
<style>
.stats-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: none;
    height: 100%;
    transition: transform 0.2s ease;
}

.stats-card:hover {
    transform: translateY(-5px);
}

.stats-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: white;
    margin-bottom: 1rem;
}

.bg-primary-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.bg-success-gradient {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.bg-warning-gradient {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.bg-info-gradient {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.stats-number {
    font-size: 2rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.stats-label {
    color: #7f8c8d;
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.stats-change {
    font-size: 0.875rem;
    font-weight: 500;
}

.stats-change.positive {
    color: #27ae60;
}

.chart-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: none;
    height: 100%;
}

.modern-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: none;
    height: 100%;
}

.card-header {
    background: transparent;
    border-bottom: 1px solid #f8f9fa;
    padding: 1.5rem 1.5rem 1rem;
}

.card-body {
    padding: 1rem 1.5rem 1.5rem;
}

.activity-feed {
    max-height: 300px;
    overflow-y: auto;
}

.activity-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1.5rem;
}

.activity-item:last-child {
    margin-bottom: 0;
}

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    margin-right: 1rem;
    flex-shrink: 0;
}

.activity-content h6 {
    color: #2c3e50;
    font-weight: 600;
}

.table-hover tbody tr:hover {
    background-color: #f8f9fa;
}

.progress {
    background-color: #e9ecef;
}

.progress-bar {
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
}
</style>
{% endblock %}